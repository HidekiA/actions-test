name: test-cf

on:
  workflow_dispatch:
    inputs:
      CREATE_CHANGESET:
        required: false
        type: boolean
        default: false
        description: dry-run
      DEPLOY:
        required: false
        type: boolean
        default: false
        description: deploy
  pull_request:
    types: [opened, reopened, synchronize, closed]
    paths:
      - iac/test-cfn/**

env:
  TEMPLATE_FILE: test.yaml

jobs:
  cf-test:
    uses: ./.github/workflows/called-cfn-deploy.yml
    with:
      # CREATE_CHANGESET: ${{ inputs.CREATE_CHANGESET }}
      # DEPLOY: ${{ inputs.DEPLOY }}
      CREATE_CHANGESET: ${{ github.event.pull_request.merged != true }}
      DEPLOY: ${{ github.event.pull_request.merged }}
      STACK_NAME: cloudfront-test
      TEMPLATE_FILE_NAME: test.yml
      WORKING_DIRECTORY: iac/test_cfn
    secrets: inherit
